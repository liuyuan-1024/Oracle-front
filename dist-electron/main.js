"use strict";const s=require("electron"),t=require("path");process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";let e,r;const l=s.Menu.buildFromTemplate([{label:"显示窗口",click:()=>{e==null||e.show()}},{label:"最小化",click:()=>{e==null||e.minimize()}},{label:"退出",click:()=>{process.platform!=="darwin"&&s.app.quit()}}]);function i(){e=new s.BrowserWindow({frame:!1,resizable:!1,width:1120,height:800,backgroundColor:"#2e2b43",icon:t.join(__dirname,"../public/favicon.ico"),webPreferences:{nodeIntegration:!0,preload:t.join(__dirname,"preload.js")}}),process.env.NODE_ENV!=="development"?e.loadFile(t.join(__dirname,"../dist/index.html")):e.loadURL(`${process.env.VITE_DEV_SERVER_URL}:${process.env.VITE_DEV_SERVER_PORT}`),e.webContents.openDevTools()}function c(){r=new s.Tray(t.join(__dirname,"../public/favicon.ico")),r.setToolTip("Oracle"),r.setContextMenu(l),console.log("路径",__dirname)}s.app.whenReady().then(()=>{i(),c(),e==null||e.webContents.session.webRequest.onBeforeSendHeaders((o,n)=>{n({requestHeaders:{Origin:"*",...o.requestHeaders}})}),e==null||e.webContents.session.webRequest.onHeadersReceived((o,n)=>{n({responseHeaders:{"Access-Control-Allow-Origin":["*"],...o.responseHeaders}})}),s.app.on("activate",function(o){s.BrowserWindow.getAllWindows().length===0&&i()}),r==null||r.on("click",function(){e==null||e.show()})});s.app.on("ready",()=>{s.ipcMain.on("minimize-window",()=>{e==null||e.minimize()}),s.ipcMain.on("maximize-window",()=>{e!=null&&e.isMaximized()?e==null||e.unmaximize():e==null||e.maximize()}),s.ipcMain.on("close-window",o=>{o.preventDefault(),e==null||e.hide()})});

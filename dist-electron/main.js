"use strict";const s=require("electron"),l=require("path");process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";let e,o;const c=s.Menu.buildFromTemplate([{label:"显示窗口",click:()=>{e==null||e.show()}},{label:"最小化",click:()=>{e==null||e.minimize()}},{label:"退出",click:()=>{process.platform!=="darwin"&&s.app.quit()}}]);function n(){e=new s.BrowserWindow({frame:!1,resizable:!1,width:1120,height:800,backgroundColor:"#2e2b43",webPreferences:{nodeIntegration:!0,preload:l.join(__dirname,"preload.js")}}),process.env.NODE_ENV!=="development"?e.loadFile(l.join(__dirname,"../dist/index.html")):e.loadURL(`${process.env.VITE_DEV_SERVER_URL}:${process.env.VITE_DEV_SERVER_PORT}`),e.webContents.openDevTools()}function i(){o=new s.Tray(l.join(__dirname,"../public/favicon.ico")),o.setToolTip("Oracle"),o.setContextMenu(c),console.log("路径",__dirname)}s.app.whenReady().then(()=>{n(),i(),e==null||e.webContents.session.webRequest.onBeforeSendHeaders((r,t)=>{t({requestHeaders:{Origin:"*",...r.requestHeaders}})}),e==null||e.webContents.session.webRequest.onHeadersReceived((r,t)=>{t({responseHeaders:{"Access-Control-Allow-Origin":["*"],...r.responseHeaders}})}),s.app.on("activate",function(r){s.BrowserWindow.getAllWindows().length===0&&n()}),o==null||o.on("click",function(){e==null||e.show()})});s.app.on("ready",()=>{s.ipcMain.on("minimize-window",()=>{e==null||e.minimize()}),s.ipcMain.on("maximize-window",()=>{e!=null&&e.isMaximized()?e==null||e.unmaximize():e==null||e.maximize()}),s.ipcMain.on("close-window",r=>{r.preventDefault(),e==null||e.hide()})});
